<div class="max-w-lg mx-auto">
  <h2 class="text-xl font-bold mb-4">ë‚´ ì˜ˆì•½</h2>
  
  <!-- í•„í„° -->
  <div class="bg-white rounded-lg p-3 shadow mb-4">
    <%= form_with url: reservations_path, method: :get, class: "flex flex-col gap-2" do |f| %>
      <div class="flex gap-2">
        <%= f.select :status, 
            options_for_select([
              ['ì „ì²´ ìƒíƒœ', ''],
              ['ì´ìš© ì „', 'active'],
              ['ì™„ë£Œ', 'completed'],
              ['ì·¨ì†Œ', 'cancelled'],
              ['ë…¸ì‡¼', 'no_show']
            ], params[:status]),
            {},
            class: "flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm" %>
        
        <%= f.date_field :date, 
            value: params[:date],
            class: "px-3 py-2 border border-gray-300 rounded-lg text-sm" %>
      </div>
      
      <div class="flex gap-2">
        <%= f.submit "ê²€ìƒ‰", class: "flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 cursor-pointer text-sm" %>
        
        <% if params[:status].present? || params[:date].present? %>
          <%= link_to "ì´ˆê¸°í™”", reservations_path, class: "px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 text-sm" %>
        <% end %>
      </div>
    <% end %>
  </div>
  
  <div class="space-y-3">
    <% if @reservations.any? %>
      <% @reservations.each do |reservation| %>
        <div class="bg-white rounded-lg p-4 shadow">
          <div class="flex justify-between items-start mb-2">
            <div>
              <h3 class="font-medium">
                <%= reservation.start_time.strftime('%Yë…„ %mì›” %dì¼') %>
              </h3>
              <p class="text-sm text-gray-600">
                <%= reservation.start_time.strftime('%H:%M') %> - <%= reservation.end_time.strftime('%H:%M') %>
              </p>
              <p class="text-sm text-gray-600"><%= reservation.room.number %>ë²ˆ ì—°ìŠµì‹¤</p>
            </div>
            <div class="flex items-center gap-2">
              <% if reservation.room.has_outlet %>
                <span class="text-xs">ğŸ”Œ</span>
              <% end %>
              <% status_text = reservation.status_display %>
              <% case status_text %>
              <% when 'ì´ìš© ì „' %>
                <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded">ì´ìš© ì „</span>
              <% when 'ì´ìš© ì¤‘' %>
                <span class="px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded">ì´ìš© ì¤‘</span>
              <% when 'ì™„ë£Œ', 'completed' %>
                <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">ì™„ë£Œ</span>
              <% when 'cancelled' %>
                <span class="px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded">ì·¨ì†Œ</span>
              <% when 'no_show' %>
                <span class="px-2 py-1 text-xs bg-red-100 text-red-800 rounded">ë…¸ì‡¼</span>
              <% else %>
                <span class="px-2 py-1 text-xs bg-gray-100 text-gray-800 rounded"><%= status_text %></span>
              <% end %>
            </div>
          </div>
          
          <% if reservation.cancellable? %>
            <div class="mt-3 pt-3 border-t">
              <%= link_to "ì˜ˆì•½ ì·¨ì†Œ", cancel_reservation_path(reservation), 
                          method: :patch, 
                          data: { 
                            turbo_method: :patch,
                            reservation_date: reservation.start_time.strftime('%Yë…„ %mì›” %dì¼'),
                            reservation_time: "#{reservation.start_time.strftime('%H:%M')} - #{reservation.end_time.strftime('%H:%M')}",
                            reservation_room: "#{reservation.room.number}ë²ˆ",
                            action: "reservation-cancel"
                          },
                          class: "text-sm text-red-600 hover:text-red-800 reservation-cancel-btn" %>
            </div>
          <% end %>
        </div>
      <% end %>
    <% else %>
      <div class="text-center py-8">
        <p class="text-gray-500 mb-4">ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        <%= link_to "ì˜ˆì•½í•˜ê¸°", new_reservation_path, 
                    class: "inline-block bg-blue-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-700" %>
      </div>
    <% end %>
  </div>
  
  <div class="mt-6">
    <%= link_to "í™ˆìœ¼ë¡œ", root_path, class: "text-gray-600 text-sm" %>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add event listeners to all cancel buttons
  const cancelButtons = document.querySelectorAll('.reservation-cancel-btn');
  
  cancelButtons.forEach(button => {
    button.addEventListener('click', function(event) {
      event.preventDefault();
      
      // Get reservation info from data attributes
      const date = this.dataset.reservationDate;
      const time = this.dataset.reservationTime;
      const room = this.dataset.reservationRoom;
      
      // Create confirm message
      const confirmMessage = `ì˜ˆì•½ ì •ë³´\n\në‚ ì§œ: ${date}\nì‹œê°„: ${time}\nì—°ìŠµì‹¤: ${room}\n\nì˜ˆì•½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
      
      // Show confirm dialog
      if (confirm(confirmMessage)) {
        // If user confirms, proceed with the cancellation
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = this.href;
        
        // Add CSRF token
        const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'authenticity_token';
        csrfInput.value = csrfToken;
        
        // Add method input for PATCH
        const methodInput = document.createElement('input');
        methodInput.type = 'hidden';
        methodInput.name = '_method';
        methodInput.value = 'patch';
        
        form.appendChild(csrfInput);
        form.appendChild(methodInput);
        document.body.appendChild(form);
        form.submit();
      }
    });
  });
});
</script>